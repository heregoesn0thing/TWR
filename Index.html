<!DOCTYPE html>
<html>
<head>
<title>ATC Simulator</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
body{ margin:0; }
#map{ height:100vh; width:100vw; }

.icon-wrapper{
  width:70px;
  height:60px;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  position:relative;
}

.icon-aircraft{
  font-size:26px;
  transform-origin:center center;
}

.callsign-label{
  position:absolute;
  bottom:-18px;
  font-size:11px;
  font-weight:bold;
  color:white;
  background:black;
  padding:2px 5px;
  border-radius:4px;
  white-space:nowrap;
}

.status-label{
  position:absolute;
  top:-16px;
  font-size:10px;
  font-weight:bold;
  color:white;
  background:blue;
  padding:2px 4px;
  border-radius:4px;
  display:none;
}

#menuAeronave{
  position:fixed;
  top:120px;
  left:20px;
  background:rgba(20,20,20,0.95);
  color:white;
  border-radius:8px;
  display:none;
  z-index:2000;
  width:260px;
  font-family:monospace;
}

#panelHeader{
  background:#111;
  padding:8px;
  cursor:move;
  display:flex;
  justify-content:space-between;
}

#panelBody{ padding:10px; }

#panelBody button{
  width:100%;
  margin-top:6px;
  padding:6px;
  cursor:pointer;
}

#aircraftInfo{
  font-size:12px;
  margin-bottom:10px;
  background:#000;
  padding:6px;
  border-radius:4px;
}

#relojPanel{
  position:fixed;
  top:15px;
  right:15px;
  background:rgba(0,0,0,0.85);
  color:white;
  padding:12px;
  border-radius:8px;
  text-align:center;
  z-index:3000;
  font-family:monospace;
}

#relojHora{ font-size:20px; margin-bottom:8px; }
</style>
</head>

<body>

<div id="map"></div>

<div id="relojPanel">
  <div id="relojHora">00:00:00</div>
  <button onclick="iniciarReloj()">▶</button>
  <button onclick="pausarReloj()">⏸</button>
  <button onclick="ajustarHora()">✏</button>
</div>

<!-- SOCKET.IO DEBE IR ANTES DEL SCRIPT PRINCIPAL -->
<script src="/socket.io/socket.io.js"></script>

<script>

// ================= SOCKET =================

const socket = io()

// ================= MAP =================

const map = L.map('map').setView([-13.7443,-76.2204],16)

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
  maxZoom:19
}).addTo(map)

// ================= VARIABLES =================

let aeronaves = []
let aeronaveSeleccionada = null
let modoRuta = false
let rutaTemporal = []

// ================= ICON =================

function crearIcono(callsign,tipo){
  return L.divIcon({
    className:"",
    iconSize:[70,60],
    iconAnchor:[35,30],
    html:`
      <div class="icon-wrapper">
        <div class="status-label">TAXIING</div>
        <div class="icon-aircraft">✈</div>
        <div class="callsign-label">${callsign} (${tipo})</div>
      </div>
    `
  })
}

// ================= CREATE AIRCRAFT =================

map.on("click", function(e){

  const callsign = prompt("Callsign:")
  if(!callsign) return

  const tipo = prompt("Type (A320/A319/C172/AN32):")
  if(!tipo) return

  const marker = L.marker(e.latlng,{
    icon:crearIcono(callsign,tipo),
    draggable:true
  }).addTo(map)

  const nueva = { callsign, tipo, marker }

  aeronaves.push(nueva)

  // Emitir al servidor
  socket.emit("crearAeronave",{
    callsign,
    tipo,
    lat:e.latlng.lat,
    lng:e.latlng.lng
  })

})

// ================= RECEIVE REMOTE =================

socket.on("crearAeronave",(data)=>{

  const marker = L.marker([data.lat,data.lng],{
    icon:crearIcono(data.callsign,data.tipo),
    draggable:false
  }).addTo(map)

  aeronaves.push({
    callsign:data.callsign,
    tipo:data.tipo,
    marker
  })

})

// ================= CLOCK =================

let segundosTotales=0
let intervaloReloj=null

function actualizarReloj(){
  let h=Math.floor(segundosTotales/3600)
  let m=Math.floor((segundosTotales%3600)/60)
  let s=segundosTotales%60
  document.getElementById("relojHora").innerText=
    `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`
}

function iniciarReloj(){
  if(intervaloReloj) return
  intervaloReloj=setInterval(()=>{segundosTotales++;actualizarReloj()},1000)
}

function pausarReloj(){
  clearInterval(intervaloReloj)
  intervaloReloj=null
}

function ajustarHora(){
  const t=prompt("Enter time HH:MM:SS")
  if(!t) return
  const p=t.split(":")
  segundosTotales=parseInt(p[0])*3600+parseInt(p[1])*60+parseInt(p[2])
  actualizarReloj()
}

actualizarReloj()

</script>

</body>
</html>








































